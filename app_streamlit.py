import streamlit as st
import os

# ============================================
# 1. ุงูุชุญูู ูู ุชุซุจูุช ุงูููุชุจุงุช
# ============================================
def check_libraries():
    """ุงูุชุญูู ูู ุงูููุชุจุงุช ุงููุซุจุชุฉ"""
    libraries = {
        'streamlit': True,  # ููุฌูุฏุฉ ูุณุจูุงู
        'pandas': False,
        'plotly': False,
        'openai': False,
        'supabase': False,
        'python-dotenv': False
    }
    
    results = []
    
    for lib, required in libraries.items():
        try:
            __import__(lib)
            results.append(f"โ {lib}")
        except ImportError:
            if required:
                results.append(f"โ๏ธ {lib} (ุบูุฑ ูุซุจุช)")
            else:
                results.append(f"โ {lib} (ุบูุฑ ูุซุจุช)")
    
    return results

# ============================================
# 2. ุฅุนุฏุงุฏุงุช ุงูุตูุญุฉ
# ============================================
st.set_page_config(
    page_title="ุงูููุตุฉ ุงูุชุนููููุฉ ุงูุฐููุฉ",
    page_icon="๐",
    layout="wide"
)

# ============================================
# 3. ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
# ============================================
st.title("๐ ุงูููุตุฉ ุงูุชุนููููุฉ ุงูุฐููุฉ")
st.markdown("### ุงููุณุฎุฉ ุงูุฎูููุฉ - ุชุนูู ุนูู Streamlit Cloud")

# ุนุฑุถ ุญุงูุฉ ุงูููุชุจุงุช
st.markdown("---")
st.subheader("๐ง ุญุงูุฉ ุงูููุชุจุงุช ุงููุซุจุชุฉ")

lib_status = check_libraries()
for status in lib_status:
    st.write(status)

# ุฅุฐุง ูุดู ุชุซุจูุช ุจุนุถ ุงูููุชุจุงุชุ ูุณุชุฎุฏู ูุณุฎุฉ ุจุฏููุฉ
if any("โ" in status for status in lib_status) or any("โ๏ธ" in status for status in lib_status):
    st.warning("""
    โ๏ธ ุจุนุถ ุงูููุชุจุงุช ุบูุฑ ูุซุจุชุฉ.
    **ุงูุญู:** ุงูุชุธุฑ ุฏูููุฉ ุซู ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ.
    ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉุ ุงุณุชุฎุฏู ุงูุฒุฑ ุฃุฏูุงู.
    """)
    
    if st.button("๐ ุงุณุชุฎุฏุงู ุงููุณุฎุฉ ุงูุฎูููุฉ ุจุฏูู ููุชุจุงุช ุฅุถุงููุฉ"):
        st.session_state.use_light_version = True
        st.rerun()

# ุงูุชุญูู ูู ุญุงูุฉ ุงูุฌูุณุฉ
if "use_light_version" not in st.session_state:
    st.session_state.use_light_version = False

# ============================================
# 4. ุงููุณุฎุฉ ุงูุฎูููุฉ (ุชุนูู ุจุฏูู ููุชุจุงุช ุฎุงุฑุฌูุฉ)
# ============================================
def light_version():
    """ุงููุณุฎุฉ ุงูุฎูููุฉ ุงูุชู ุชุนูู ุจุฏูู ููุชุจุงุช ุฅุถุงููุฉ"""
    st.success("โ ุงููุณุฎุฉ ุงูุฎูููุฉ ุชุนูู ุจูุฌุงุญ!")
    
    # ุดุฑูุท ุฌุงูุจู ุจุณูุท
    with st.sidebar:
        st.title("ุงููุงุฆูุฉ")
        page = st.radio(
            "ุงุฎุชุฑ ุงูุตูุญุฉ:",
            ["๐ ุงูุฑุฆูุณูุฉ", "๐ ุงูุฏุฑูุณ", "๐ง ุชูุงุฑูู", "๐ค ุญุณุงุจู"]
        )
        
        st.markdown("---")
        if st.button("๐ช ุชุณุฌูู ุงูุฎุฑูุฌ"):
            st.info("ุชู ุชุณุฌูู ุงูุฎุฑูุฌ")
    
    # ุงููุญุชูู ุงูุฑุฆูุณู
    if page == "๐ ุงูุฑุฆูุณูุฉ":
        st.subheader("ูุฑุญุจุงู ุจู ูู ุงูููุตุฉ ุงูุชุนููููุฉ")
        
        col1, col2, col3 = st.columns(3)
        with col1:
            st.metric("ุงูุฏุฑูุณ", "12")
        with col2:
            st.metric("ุงูุชูุงุฑูู", "47")
        with col3:
            st.metric("ุงูุชูุฏู", "75%")
        
        # ุฏุฑูุณ ุงูุชุฑุงุถูุฉ
        st.markdown("### ๐ ุงูุฏุฑูุณ ุงููุชุงุญุฉ")
        lessons = ["ุงูุฌุจุฑ", "ุงูููุฒูุงุก", "ุงููุบุฉ ุงูุนุฑุจูุฉ", "ุงูุชุงุฑูุฎ"]
        for lesson in lessons:
            with st.expander(f"ุฏุฑุณ: {lesson}"):
                st.write(f"ูุญุชูู ุฏุฑุณ {lesson} ุณูุธูุฑ ููุง.")
                if st.button(f"ุจุฏุก ุฏุฑุณ {lesson}"):
                    st.success(f"ุจุฏุฃุช ุฏุฑุณ {lesson}")
    
    elif page == "๐ ุงูุฏุฑูุณ":
        st.subheader("ููุชุจุฉ ุงูุฏุฑูุณ")
        st.info("ุงูููุชุจุฉ ุงููุงููุฉ ุชุญุชุงุฌ ุงุชุตุงูุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช")
        
        # ุฏุฑูุณ ุชุฌุฑูุจูุฉ
        for i in range(1, 4):
            st.write(f"{i}. ุฏุฑุณ ุชุฌุฑูุจู {i}")
    
    elif page == "๐ง ุชูุงุฑูู":
        st.subheader("ุงูุชูุงุฑูู ุงูุชุนููููุฉ")
        
        # ุชูุงุฑูู ุชูุงุนููุฉ ุจุณูุทุฉ
        st.write("**ูุง ูู ูฅ ร ูงุ**")
        answer = st.number_input("ุงูุฅุฌุงุจุฉ", min_value=0, max_value=100, value=0)
        
        if st.button("ุชุญูู"):
            if answer == 35:
                st.success("โ ุตุญูุญ! ุฃุญุณูุช")
            else:
                st.error("โ ุญุงูู ูุฑุฉ ุฃุฎุฑู")
    
    elif page == "๐ค ุญุณุงุจู":
        st.subheader("ุฅุนุฏุงุฏุงุช ุงูุญุณุงุจ")
        name = st.text_input("ุงุณูู", "ุทุงูุจ")
        if st.button("ุญูุธ"):
            st.success(f"ุชู ุญูุธ ุงูุงุณู: {name}")

# ============================================
# 5. ุงููุณุฎุฉ ุงููุงููุฉ (ุฅุฐุง ูุงูุช ุงูููุชุจุงุช ูุซุจุชุฉ)
# ============================================
def full_version():
    """ุงููุณุฎุฉ ุงููุงููุฉ ูุน ุฌููุน ุงูููุชุจุงุช"""
    try:
        # ูุญุงููุฉ ุงุณุชูุฑุงุฏ ุงูููุชุจุงุช
        import pandas as pd
        import plotly.graph_objects as go
        
        st.success("๐ ุงููุณุฎุฉ ุงููุงููุฉ ุชุนูู!")
        
        # ุนุฑุถ ุจูุงูุงุช ุชุฌุฑูุจูุฉ
        data = pd.DataFrame({
            'ุงููุงุฏุฉ': ['ุฑูุงุถูุงุช', 'ุนููู', 'ูุบุฉ ุนุฑุจูุฉ', 'ููุฒูุงุก'],
            'ุงูุฏุฑุฌุฉ': [85, 70, 90, 65]
        })
        
        st.dataframe(data)
        
        # ุฑุณู ุจูุงูู
        fig = go.Figure(data=[
            go.Bar(
                x=data['ุงููุงุฏุฉ'],
                y=data['ุงูุฏุฑุฌุฉ'],
                marker_color=['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4']
            )
        ])
        
        fig.update_layout(
            title="ุชูุฏูู ูู ุงูููุงุฏ",
            height=400
        )
        
        st.plotly_chart(fig, use_container_width=True)
        
    except ImportError as e:
        st.error(f"ุฎุทุฃ ูู ุงุณุชูุฑุงุฏ ุงูููุชุจุงุช: {e}")
        st.info("ุฌุงุฑู ุงูุชุจุฏูู ูููุณุฎุฉ ุงูุฎูููุฉ...")
        st.session_state.use_light_version = True
        st.rerun()

# ============================================
# 6. ุงูุชุดุบูู ุงูุฑุฆูุณู
# ============================================
if st.session_state.use_light_version:
    light_version()
else:
    # ูุญุงููุฉ ุชุดุบูู ุงููุณุฎุฉ ุงููุงููุฉ
    try:
        # ุงุฎุชุจุงุฑ ุจุณูุท ููุนุฑูุฉ ูุง ุฅุฐุง ุงูููุชุจุงุช ูุซุจุชุฉ
        import pandas
        import plotly
        full_version()
    except ImportError:
        light_version()

# ============================================
# 7. ูุนูููุงุช ุงููุธุงู
# ============================================
with st.expander("๐ ูุนูููุงุช ุงููุธุงู"):
    st.write(f"**ุฅุตุฏุงุฑ Streamlit:** {st.__version__}")
    st.write(f"**ุงููุณุงุฑ:** {os.getcwd()}")
    st.write(f"**ุงููููุงุช:** {', '.join([f for f in os.listdir('.') if f.endswith('.py') or f == 'requirements.txt'])}")
    
    # ุนุฑุถ ูุญุชูู requirements.txt ุฅุฐุง ูุงู ููุฌูุฏุงู
    if os.path.exists('requirements.txt'):
        with open('requirements.txt', 'r') as f:
            st.code(f.read(), language='txt')

# ============================================
# 8. ุชุนูููุงุช ูููุณุชุฎุฏู
# ============================================
st.markdown("---")
st.info("""
**๐ก ุฅุฐุง ุงุณุชูุฑุช ูุดููุฉ ุงูุชุซุจูุช:**
1. ุงูุชุธุฑ ุฏูููุฉ ุซู ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ
2. ุชุญูู ูู ููู `requirements.txt`
3. ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ููู `setup.sh`
""")
